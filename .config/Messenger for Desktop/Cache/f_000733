if (self.CavalryLogger) { CavalryLogger.start_js(["1tP8b"]); }

__d("MessengerWebDeltasTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){this.clear()}a.prototype.log=function(){b("GeneratedLoggerUtils").log("logger:MessengerWebDeltasLoggerConfig",this.$1,b("Banzai").BASIC)};a.prototype.logVital=function(){b("GeneratedLoggerUtils").log("logger:MessengerWebDeltasLoggerConfig",this.$1,b("Banzai").VITAL)};a.prototype.logImmediately=function(){b("GeneratedLoggerUtils").log("logger:MessengerWebDeltasLoggerConfig",this.$1,{signal:!0})};a.prototype.clear=function(){this.$1={};return this};a.prototype.getData=function(){return babelHelpers["extends"]({},this.$1)};a.prototype.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.setDeltaEvent=function(a){this.$1.delta_event=a;return this};a.prototype.setDeltaType=function(a){this.$1.delta_type=a;return this};a.prototype.setIgnoreReason=function(a){this.$1.ignore_reason=a;return this};a.prototype.setSyncSeqID=function(a){this.$1.sync_seq_id=a;return this};a.prototype.setTime=function(a){this.$1.time=a;return this};a.prototype.setVC=function(a){this.$1.vc=a;return this};a.prototype.setWeight=function(a){this.$1.weight=a;return this};c={delta_event:!0,delta_type:!0,ignore_reason:!0,sync_seq_id:!0,time:!0,vc:!0,weight:!0};e.exports=a}),null);
__d("MessengerThreadsWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(){__p&&__p();var a;a=babelHelpers.inherits(c,b("WebGraphQLQueryBase"));a&&a.prototype;c.__getDocID=function(){"use strict";return"1955136014576208"};c.getQueryID=function(){"use strict";return"303868500211442"};function c(){"use strict";a.apply(this,arguments)}return c}()}),null);
__d("MessengerGraphQLThreadFetcher.bs",["Promise","bs_array","BanzaiODS","bs_caml_array","bs_pervasives","WebGraphQL","bs_caml_format","bs_js_primitive","bs_js_null_undefined","MercuryServerRequestsConfig","MessengerThreadFetchLoggerUtil","MessengerThreadsWebGraphQLQuery","MessengerServerPayloadTransformer.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(a,c,d,e,f){__p&&__p();if(a==null)if(e)return{actions:null,thread:undefined,end_of_history:{type:"user",fbid:c},roger:null,delivery_receipts:[]};else return{actions:null,thread:undefined,end_of_history:undefined,roger:null,delivery_receipts:[]};else{e=[];var g=b("MessengerServerPayloadTransformer.bs").getThreadFBID(a),h=b("MessengerServerPayloadTransformer.bs").getOtherUserID(a);g=h==null?g==null?b("bs_pervasives").failwith("No thread ID"):g:h;g!==c&&b("bs_pervasives").failwith("Thread ID mismatch");h=b("MessengerServerPayloadTransformer.bs").transformThread(d,a,f);g=b("bs_js_null_undefined").fromOption(b("MessengerServerPayloadTransformer.bs").transformMessages(d,a,f));f=b("MessengerServerPayloadTransformer.bs").transformReadReceipts(d,a);if(f!==undefined){d={};d[c]=b("bs_js_primitive").valFromOption(f);f=d}else f=null;d=b("MessengerServerPayloadTransformer.bs").transformDeliveryReceipts(a);if(d.length>=1){d=b("bs_caml_array").caml_array_get(d,0);h.is_canonical?e.push({other_user_fbid:c,thread_fbid:null,time:b("bs_caml_format").caml_float_of_string(d.timestamp_precise)}):e.push({other_user_fbid:null,thread_fbid:c,time:b("bs_caml_format").caml_float_of_string(d.timestamp_precise)})}d=b("MessengerServerPayloadTransformer.bs").getMessagePageInfo(a);if(d!==undefined)if(b("bs_js_primitive").valFromOption(d).has_previous_page)return{actions:g,thread:h,end_of_history:undefined,roger:f,delivery_receipts:e};else return{actions:g,thread:h,end_of_history:{type:"thread",fbid:c},roger:f,delivery_receipts:e};else return{actions:g,thread:h,end_of_history:undefined,roger:f,delivery_receipts:e}}}function h(a){b("MessengerThreadFetchLoggerUtil").markerPoint(a.id,"sendThreadInfoFetchRequest");return new(b("MessengerThreadsWebGraphQLQuery"))({id:a.id,message_limit:a.limit,load_messages:a.limit>0,load_read_receipts:a.loadReadReceipts,load_delivery_receipts:a.loadDeliveryReceipts,before:a.timestamp})}function a(a,c,d){__p&&__p();var e=b("bs_array").map(h,c);return b("Promise").all(b("WebGraphQL").execAll(e,{actorID:d?a:null,batchName:"MessengerGraphQLThreadFetcher",msgrRegion:b("MercuryServerRequestsConfig").msgrRegion}))["catch"](function(a){b("BanzaiODS").bumpEntityKey("messenger_webgraphql","fetch_thread.failure");c.forEach(function(a){b("MessengerThreadFetchLoggerUtil").markerEnd(a.id,"FAIL");return 0});return b("Promise").reject(a)}).then(function(e){b("BanzaiODS").bumpEntityKey("messenger_webgraphql","fetch_thread.success");return b("bs_array").mapi(function(e,f){f=f.message_thread;e=b("bs_caml_array").caml_array_get(c,e);b("MessengerThreadFetchLoggerUtil").markerPoint(e.id,"getThreadInfoFetchResponse");return g(f,e.id,a,e.isCanonical,d)},e)})}f._transformPayload=g;f._getQuery=h;f.fetchAll=a}),null);
__d("MessengerThreadFetcher.bs",["Promise","bs_curry","FBIDCheck","bs_belt_Array","bs_caml_int32","MercuryIDs","bs_js_primitive","MercuryDispatcher","MercuryThreadIDMap","MercuryPayloadSource","bs_caml_builtin_exceptions","setTimeoutAcrossTransitions","MessengerGraphQLThreadFetcher.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=new Map();function h(a,c){__p&&__p();var d=c.other_user_fbid;if(d==null){c=c.thread_fbid;if(c==null)throw[b("bs_caml_builtin_exceptions").invalid_argument,"Encountered thread with no server identifier"];else c=[c,b("MercuryIDs").getThreadIDFromThreadFBID(c)]}else c=[d,b("MercuryIDs").getThreadIDFromUserID(d)];d=c[1];c=c[0];a=b("MercuryThreadIDMap").getForFBID(a);var e={},f=a.getClientIDFromServerIDNow(c);if(f==null){a.setServerIDToClientID(c,d);e[c]=d;return[d,e]}else return[f,e]}function i(a,c,d){__p&&__p();var e=!b("FBIDCheck").isUser_deprecated(a);return b("MessengerGraphQLThreadFetcher.bs").fetchAll(a,[{id:c,limit:0,loadReadReceipts:!1,loadDeliveryReceipts:!1,timestamp:null,isCanonical:d}],e).then(function(c){__p&&__p();c=b("bs_belt_Array").get(c,0);if(c!==undefined){c=b("bs_js_primitive").valFromOption(c).thread;if(c==null)return b("Promise").resolve(!1);else{var d=h(a,c);b("MercuryDispatcher").getForFBID(a).handleUpdate({threads:[Object.assign(c,{thread_id:d[0]})],pinned_thread_ids:[],newlyAddedClientIDs:d[1],actions:[],preprocessed:!0,payload_source:b("MercuryPayloadSource").SERVER_FETCH_THREAD_INFO});return b("Promise").resolve(!0)}}else return b("Promise").resolve(!1)})}function j(a,c,d){__p&&__p();return i(a,c,d).then(function(d){__p&&__p();var e=g.get(a);if(e==null)return b("Promise").resolve(!1);else{var f=e.get(c);if(f==null)return b("Promise").resolve(!1);else{b("bs_belt_Array").forEach(f[1],function(a){return b("bs_curry")._1(a,d)});e["delete"](c);return b("Promise").resolve(d)}}})["catch"](function(){__p&&__p();var e=g.get(a);if(e==null)return b("Promise").resolve(!1);else{var f=e.get(c);if(f==null)return b("Promise").resolve(!1);else{var h=f[1];f=f[0];if(f<5){var k=b("bs_caml_int32").imul(Math.pow(2,Math.min(f,5)),1e3),l=new(b("Promise"))(function(f,g){__p&&__p();b("setTimeoutAcrossTransitions")(function(){i(a,c,d).then(function(a){f(a);b("bs_belt_Array").forEach(h,function(c){return b("bs_curry")._1(c,a)});e["delete"](c);return b("Promise").resolve(a)})["catch"](function(){return j(a,c,d)});return 0},k);return 0});e.set(c,[f+1|0,h]);return l}else{e["delete"](c);return b("Promise").resolve(!1)}}}})}function a(a,b,c,d){__p&&__p();var e=g.get(a);if(e==null){var f=new Map();f.set(b,[0,[d]]);g.set(a,f);j(a,b,c);return 0}else{f=e.get(b);if(f==null){e.set(b,[0,[d]]);j(a,b,c);return 0}else{f[1].push(d);return 0}}}f.fetch=a}),null);
__d("MessengerWebDeltaEvents",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({DELTA_RECEIVED:"DELTA_RECEIVED",DELTA_IGNORED:"DELTA_IGNORED"})}),null);
__d("MessengerWebDeltasTypedLoggerBootloader.bs",["Bootload.bs","Bootloader"],(function(a,b,c,d,e,f){"use strict";function a(a){b("Bootloader").loadModules(["MessengerWebDeltasTypedLogger"],a,"MessengerWebDeltasTypedLoggerBootloader.bs");return 0}c=[a];d=b("Bootload.bs").Create(c);f.BootloadableMessengerWebDeltasTypedLogger=c;f.LoadableMessengerWebDeltasTypedLogger=d}),null);
__d("MessengerDeltaTransformer.bs",["FBID.bs","bs_block","bs_curry","gkx","bs_js_json","bs_caml_obj","FBIDCheck","bs_belt_Array","bs_caml_array","DateConsts","MercuryIDs","bs_belt_Option","bs_js_primitive","MessagingTag","MontageActions","bs_js_null_undefined","MercuryActionType","MercuryDispatcher","MSuggestionActions","MercuryThreadIDMap","PageCommItemStatus","MercuryPayloadSource","MercuryProfileRanges","MercuryLogMessageType","MercuryServerRequests","MercurySyncDeltaTypes","MessagingThreadAction","MessengerParticipants.bs","MessengerThreadFetcher.bs","bs_caml_builtin_exceptions","MercuryGlobalActionType","MercuryParticipantTypes","MessengerWebDeltaEvents","PagesMessagingEventType","MessengerGroupsSyncStatus","MessengerGroupsSyncStatus.bs","MessengerJoinableModeType","MessageUnsendabilityStatus.bs","MessengerApprovalModeTypes","IrisProtocolMessageLifetime","MessengerApprovalQueueTypes","MessengerGroupRequestSource","MercuryMessageCustomizations","MessageThreadReadStateEffect","MessengerWebDeltasTypedLogger","RepliedToMessageStatusForGraphQL","ClientSyncProtocol_GroupsSyncAction","MessengerRealtimeAttachmentTransformer.bs","MessengerWebDeltasTypedLoggerBootloader.bs","MessageLiveLocationClientSyncProtocolStopReason"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(a){try{return JSON.parse(a)}catch(a){return{}}}function h(a,c){__p&&__p();var d=b("bs_belt_Option").map(b("bs_js_primitive").nullable_to_opt(c.otherUserFbId),function(a){return a.toString()});c=b("bs_belt_Option").map(b("bs_js_primitive").nullable_to_opt(c.threadFbId),function(a){return a.toString()});a=b("MercuryThreadIDMap").getForFBID(a);if(d!==undefined){d=d;d=[b("bs_js_primitive").some(b("MercuryIDs").getThreadIDFromUserID(b("FBID.bs").ofStringExn(d))),d]}else if(c!==undefined){c=c;d=[b("bs_js_primitive").some(b("MercuryIDs").getThreadIDFromThreadFBID(b("FBID.bs").ofStringExn(c))),c]}else d=[undefined,undefined];c=d[1];d=d[0];if(c!==undefined&&d!==undefined){c=c;var e=a.hasClientIDForServerID(c);if(e)return b("bs_js_primitive").nullable_to_opt(a.getClientIDFromServerIDNow(c));else return b("bs_js_primitive").valFromOption(d)}}function i(a,c){__p&&__p();var d=parseInt(c.messageMetadata.timestamp,10),e=b("MessageThreadReadStateEffect").extractThreadStateEffectFromDelta(a,c),f=c.messageMetadata.actorFbId.toString(),i=e===b("MessageThreadReadStateEffect").MessageThreadReadStateEffectType.MARK_UNREAD&&a!==f,j=!b("FBIDCheck").isUser_deprecated(a),k=c.attachments;k=k==null?[]:b("bs_belt_Array").keepMapU(k,function(e){__p&&__p();var c=e.mercury;if(c==null){e=e.mercuryJSON;e=e==null?null:g(e)}else e=c;if(e==null)return undefined;else{c=e.extensible_attachment;var d=e.blob_attachment;e=e.sticker_attachment;e=c==null?d==null?e==null?[]:b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{extensible_attachment:null,blob_attachments:null,sticker:e},j):b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{extensible_attachment:null,blob_attachments:[d],sticker:null},j):b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{extensible_attachment:b("bs_js_null_undefined").fromOption(c==null?undefined:b("bs_js_primitive").some(c)),blob_attachments:null,sticker:null},j);return b("bs_belt_Array").get(e,0)}});var l=c.messageMetadata.tags;l=l==null?undefined:b("bs_js_null_undefined").fromOption(b("bs_belt_Array").get(l,0));var m=c.data,n;if(m==null)n=null;else{var o=m.adminSignatureCreatorID;n=o!==undefined?{creatorID:b("bs_js_null_undefined").fromOption(b("bs_js_primitive").undefined_to_opt(m.adminSignatureCreatorID)),creatorName:b("bs_js_null_undefined").fromOption(b("bs_js_primitive").undefined_to_opt(m.adminSignatureCreatorName)),creatorType:b("bs_js_null_undefined").fromOption(b("bs_js_primitive").undefined_to_opt(m.adminSignatureCreatorType)),labelType:b("bs_js_null_undefined").fromOption(b("bs_js_primitive").undefined_to_opt(m.adminSignatureLabelType)),pageID:b("bs_js_null_undefined").fromOption(b("bs_js_primitive").undefined_to_opt(m.adminSignaturePageID)),profileURI:b("bs_js_null_undefined").fromOption(b("bs_js_primitive").undefined_to_opt(m.adminSignatureProfileURI))}:null}o=h(a,c.messageMetadata.threadKey);if(o!==undefined){m=c.ttl;var p=c.messageMetadata.threadKey.threadFbId,q=c.messageMetadata.threadKey.otherUserFbId,r=c.body,s=c.data;if(s==null){var t=c.untypedData;t=t==null?!1:b("bs_belt_Option").getWithDefault(b("bs_js_primitive").undefined_to_opt(t.is_sponsored),"false")==="true"}else t=b("bs_belt_Option").getWithDefault(b("bs_js_primitive").undefined_to_opt(s.is_sponsored),"false")==="true";s=c.data;var u=c.data,v;if(u==null)v=null;else{u=u.customization;v=u!==undefined?b("MercuryMessageCustomizations").parseCustomizations(u):null}u=c.data;var w=c.data,x;if(w==null)x=null;else{w=w.message_source_data;if(w!==undefined){w=g(w);w=b("bs_js_json").classify(w);if(typeof w==="number"||w.tag!==2)x=null;else{w=w[0].message_source;x=w!==undefined?b("bs_js_null_undefined").fromOption(w===undefined?undefined:b("bs_js_primitive").some(w)):null}}else x=null}w=c.messageMetadata.skipBumpThread;var y=c.data,z;if(y==null)z=null;else{y=y.montage_reply_data;z=y!==undefined?g(y):null}y=c.data;var A;if(y==null)A=null;else{y=y.meta_ranges;A=y!==undefined?g(y):null}return{message_id:c.messageMetadata.messageId,threading_id:null,offline_threading_id:c.messageMetadata.offlineThreadingId,author:b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(f)),author_email:f+"@facebook.com",ephemeral_ttl_mode:m==null?0:b("bs_belt_Option").getWithDefault(b("bs_js_primitive").undefined_to_opt(b("IrisProtocolMessageLifetime")[m]),0),timestamp:d,is_unread:i,is_filtered_content:!1,is_filtered_content_bh:!1,is_filtered_content_account:!1,is_filtered_content_quasar:!1,is_filtered_content_invalid_app:!1,source:l,tags:c.messageMetadata.tags,is_spoof_warning:!1,folder:null,thread_fbid:p==null?null:p.toString(),other_user_fbid:q==null?null:q.toString(),body:r==null?"":r,html_body:null,subject:null,has_attachment:k.length>0,attachments:k,ranges:undefined,thread_id:o,action_type:b("MercuryActionType").USER_GENERATED_MESSAGE,is_from_iris:!0,is_sponsored:t,commerce_message_type:s==null?null:b("bs_js_null_undefined").fromOption(b("bs_js_primitive").undefined_to_opt(s.commerce_message_type)),customizations:v,platform_xmd:u==null?null:b("bs_js_null_undefined").fromOption(b("bs_js_primitive").undefined_to_opt(u.platform_xmd)),profile_ranges:b("MercuryProfileRanges").extractFromDelta(c),message_source:x,skip_bump_thread:w==null?!1:w,thread_read_state_effect:e,montage_reply_data:z,meta_ranges:A,creator_info:n,message_unsendability_status:b("MessageUnsendabilityStatus.bs").fromNullableString(c.messageMetadata.unsendType),comm_status:j?b("PageCommItemStatus").TODO:null}}else throw[b("bs_caml_builtin_exceptions").invalid_argument,"invalid thread id"]}function j(a,c,d,e){return b("bs_curry")._1(b("MessengerWebDeltasTypedLoggerBootloader.bs").LoadableMessengerWebDeltasTypedLogger[0],function(){var f=new(b("MessengerWebDeltasTypedLogger"))();f=f.setDeltaEvent(a).setDeltaType(c).setIgnoreReason(d).setSyncSeqID(e);f.log();return 0})}function k(a){return j(b("MessengerWebDeltaEvents").DELTA_RECEIVED,a,null,null)}function l(a,c){return j(b("MessengerWebDeltaEvents").DELTA_IGNORED,a,c,null)}function m(a,c,d){__p&&__p();var e=c.other_user_fbid;if(e==null){var f=c.thread_fbid;if(f==null)throw[b("bs_caml_builtin_exceptions").invalid_argument,"invalid thread id"];else f=[f,!1]}else f=[e,!0];e=f[0];var g=b("MercuryThreadIDMap").getForFBID(a);g=g.getClientIDFromServerIDNow(e);if(g==null)return b("MessengerThreadFetcher.bs").fetch(a,e,f[1],function(e){if(e){b("MercuryDispatcher").getForFBID(a).handleUpdate({actions:[c],pinned_thread_ids:[],newlyAddedClientIDs:{},preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});return k(d)}else return l(d,"thread fetch failed")});else{b("MercuryDispatcher").getForFBID(a).handleUpdate({actions:[c],pinned_thread_ids:[],newlyAddedClientIDs:{},preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});return k(d)}}function n(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=d==null?undefined:b("bs_js_primitive").some(d);if(d==null){d=c.threadKey.otherUserFbId;var f=d==null?undefined:b("bs_js_primitive").some(d);d=d==null?[undefined,undefined]:[f,{otherUserFbId:b("bs_js_null_undefined").fromOption(f),threadFbId:null}]}else d=[e,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(e)}];f=d[1];e=d[0];if(e!==undefined&&f!==undefined){d=h(a,b("bs_js_primitive").valFromOption(f));if(d!==undefined)return{thread_id:d,action_type:b("MercuryActionType").REACTION_UPDATE,messageId:c.messageId,offlineThreadingId:c.offlineThreadingId,reaction:c.reaction,senderId:c.senderId.toString(),thread_fbid:e.toString(),other_user_fbid:null,userId:c.userId.toString()};else return undefined}}function o(a){return a/Math.pow(10,8)}function p(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=d==null?undefined:b("bs_js_primitive").some(d),f=c.threadKey.otherUserFbId,g=f==null?undefined:b("bs_js_primitive").some(f);d=d==null?f==null?[undefined,undefined]:[g,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(g)}]:[e,{otherUserFbId:b("bs_js_null_undefined").fromOption(e),threadFbId:null}];f=d[1];g=d[0];if(g!==undefined&&f!==undefined){e=h(a,b("bs_js_primitive").valFromOption(f));if(e!==undefined&&c.messageLiveLocations.length===1){d=b("bs_caml_array").caml_array_get(c.messageLiveLocations,0);a=d.expirationTime;f=d.stopReason;c=f==null?Date.now()/b("DateConsts").MS_PER_SEC>a:!0;f=d.coordinate;f=f==null?null:{latitude:o(f.latitude),longitude:o(f.longitude)};var i=d.destination;i=i==null?null:{latitude:o(i.latitude),longitude:o(i.longitude),label:i.label};var j=d.stopReason;j=j==null?null:j===b("MessageLiveLocationClientSyncProtocolStopReason").EXPIRED||j===b("MessageLiveLocationClientSyncProtocolStopReason").CANCELED?"EXPIRED":j===b("MessageLiveLocationClientSyncProtocolStopReason").ARRIVED?"ARRIVED":null;return{thread_id:e,action_type:b("MercuryActionType").LIVE_LOCATION_UPDATE,thread_fbid:g.toString(),other_user_fbid:null,messageId:d.messageId,liveLocation:{live_location_id:d.id.toString(),is_expired:c,expiration_time:a,sender:{id:d.senderId.toString()},coordinate:f,location_title:d.locationTitle,sender_destination:i,stop_reason:j}}}else return undefined}}function q(a,c){var d=c.threadKey.threadFbId;if(d==null)return undefined;else{a=h(a,{otherUserFbId:null,threadFbId:d});if(a!==undefined)return{action_type:b("MercuryActionType").EVENT_RSVP_CHANGED,actor_fbid:c.actorFbId.toString(),rsvp_status:c.rsvpStatus,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a};else return undefined}}function r(a,c){__p&&__p();var d=c.threadKey.otherUserFbId;if(d==null)return undefined;else{a=h(a,{otherUserFbId:d,threadFbId:null});if(a!==undefined){c=c.isFollowUp;return{action_type:b("MercuryActionType").UPDATE_COMM_STATUS,comm_status:c?b("PageCommItemStatus").FOLLOW_UP:b("PageCommItemStatus").TODO,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a}}else return undefined}}function s(a,c){__p&&__p();var d=c.actorFbid.toString(),e=b("FBID.bs").ofStringExn(d);if(b("bs_caml_obj").caml_notequal(e,a))e=b("bs_js_primitive").some(b("MercuryIDs").getParticipantIDFromUserID(a));else{var f=c.threadKey.otherUserFbId;if(f==null)e=undefined;else{f=b("FBID.bs").ofString(f.toString());e=f!==undefined?b("bs_js_primitive").some(b("MercuryIDs").getParticipantIDFromUserID(b("bs_js_primitive").valFromOption(f))):undefined}}if(e!==undefined){f=b("bs_js_primitive").valFromOption(e);e=b("MessengerParticipants.bs").getNow(f);if(e==null||!b("bs_caml_obj").caml_equal(e.user_type,b("MercuryParticipantTypes").PAGE))e=1;else return undefined;if(e===1){e=c.threadKey.otherUserFbId;if(e==null)return undefined;else{a=h(a,{otherUserFbId:e,threadFbId:null});if(a!==undefined)return{action_type:b("MercuryActionType").BLOCK_STATUS_CHANGED,actorFbid:d,canViewerReply:c.canViewerReply,reason:c.reason,message_blocked_ids:[f],other_user_fbid:e.toString(),thread_fbid:null,thread_id:a};else return undefined}}}}function t(a,c){__p&&__p();var d=c.threadKey.threadFbId;if(d==null){var e=c.threadKey.otherUserFbId;e=e==null?[undefined,undefined]:[e.toString(),{otherUserFbId:e,threadFbId:null}]}else e=[d.toString(),{otherUserFbId:null,threadFbId:d}];d=e[1];e=e[0];if(e!==undefined&&d!==undefined){a=h(a,b("bs_js_primitive").valFromOption(d));if(a!==undefined)return{action_type:b("MercuryActionType").MONTAGE_DIRECT_EXPIRE,messageId:c.messageId,timestamp:c.timestamp,thread_fbid:e,other_user_fbid:null,keep_expiry_timestamp:c.keepExpiryTimestamp,thread_id:a};else return undefined}}function u(a,c){__p&&__p();var d=i(a,c.message),e=c.repliedToMessage;if(e==null)return b("bs_js_primitive").some(d);else{a=i(a,e);e=c.status;var f;if(e==null||e>2||e<0)f=undefined;else switch(e){case 0:f=b("bs_js_primitive").some(b("RepliedToMessageStatusForGraphQL").VALID);break;case 1:f=b("bs_js_primitive").some(b("RepliedToMessageStatusForGraphQL").DELETED);break;case 2:f=b("bs_js_primitive").some(b("RepliedToMessageStatusForGraphQL").TEMPORARILY_UNAVAILABLE);break}if(f!==undefined)return b("bs_js_primitive").some(Object.assign(d,{replied_to_message:{status:b("bs_js_primitive").valFromOption(f),message:a}}));else return undefined}}function v(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=d==null?undefined:b("bs_js_primitive").some(d);if(d==null){d=c.threadKey.otherUserFbId;var f=d==null?undefined:b("bs_js_primitive").some(d);d=d==null?[undefined,undefined]:[f,{otherUserFbId:b("bs_js_null_undefined").fromOption(f),threadFbId:null}]}else d=[e,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(e)}];f=d[1];e=d[0];if(e!==undefined&&f!==undefined){d=h(a,b("bs_js_primitive").valFromOption(f));if(d!==undefined)return{action_type:b("MercuryActionType").GROUPS_SYNC_STATUS_CHANGED,thread_fbid:e.toString(),other_user_fbid:null,actor_fbid:c.actorFbid.toString(),groups_sync_status_string:b("MessengerGroupsSyncStatus.bs").fromNullableString(c.groupsSyncStatus),thread_id:d};else return undefined}}function w(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=d==null?undefined:b("bs_js_primitive").some(d);if(d==null){d=c.threadKey.otherUserFbId;var f=d==null?undefined:b("bs_js_primitive").some(d);d=d==null?[undefined,undefined]:[f,{otherUserFbId:b("bs_js_null_undefined").fromOption(f),threadFbId:null}]}else d=[e,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(e)}];f=d[1];e=d[0];d=c.syncAction===b("ClientSyncProtocol_GroupsSyncAction").OPT_IN?b("bs_js_primitive").some(b("MessengerGroupsSyncStatus").OPT_IN):c.syncAction===b("ClientSyncProtocol_GroupsSyncAction").OPT_OUT?b("bs_js_primitive").some(b("MessengerGroupsSyncStatus").OPT_OUT):undefined;if(e!==undefined&&d!==undefined&&f!==undefined){a=h(a,b("bs_js_primitive").valFromOption(f));if(a!==undefined){f=c.syncedFbGroupId;return{action_type:b("MercuryActionType").GROUPS_SYNC_METADATA_UPDATE,thread_fbid:e.toString(),other_user_fbid:null,actor_fbid:c.actorFbid.toString(),groups_sync_action:b("bs_js_primitive").valFromOption(d),source_surface:c.sourceSurface,fb_group_id:f==null?null:f.toString(),thread_id:a}}else return undefined}}function x(a,c){var d=c.threadKey.threadFbId;if(d==null)return undefined;else{a=h(a,{otherUserFbId:null,threadFbId:d});if(a!==undefined)return{action_type:b("MercuryActionType").DESCRIPTION_CHANGED,thread_fbid:d.toString(),other_user_fbid:null,group_thread_description_string:c.threadDescription,thread_id:a};else return undefined}}function y(a){return"#"+a.slice(2)}function z(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=d==null?undefined:b("bs_js_primitive").some(d);if(d==null){d=c.threadKey.otherUserFbId;var f=d==null?undefined:b("bs_js_primitive").some(d);d=d==null?[undefined,undefined]:[f,{otherUserFbId:b("bs_js_null_undefined").fromOption(f),threadFbId:null}]}else d=[e,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(e)}];f=d[1];e=d[0];if(e!==undefined&&f!==undefined){d=e;e=h(a,b("bs_js_primitive").valFromOption(f));if(e!==undefined){a=e;f=c.fallbackColor!==""?y(c.fallbackColor):"";e=c.gradientColors;var g;if(e==null||!e.length)g=1;else{e=b("bs_belt_Array").map(e,y);return{action_type:b("MercuryActionType").UPDATE_THREAD_THEME,thread_fbid:d.toString(),other_user_fbid:null,theme_id:c.themeId,solid_color:f,header_color:b("bs_caml_array").caml_array_get(e,0),footer_color:b("bs_caml_array").caml_array_get(e,e.length-1|0),gradient_colors:e,thread_id:a}}if(g===1)return{action_type:b("MercuryActionType").UPDATE_THREAD_THEME,thread_fbid:d.toString(),other_user_fbid:null,theme_id:c.themeId,solid_color:f,header_color:f,footer_color:f,gradient_colors:[],thread_id:a}}else return undefined}}function A(a,c){__p&&__p();var d=c.threadKey.threadFbId;if(d==null){var e=c.threadKey.otherUserFbId;e=e==null?[undefined,undefined]:[e.toString(),{otherUserFbId:e,threadFbId:null}]}else e=[d.toString(),{otherUserFbId:null,threadFbId:d}];d=e[1];e=e[0];if(e!==undefined&&d!==undefined){a=h(a,b("bs_js_primitive").valFromOption(d));if(a!==undefined)return{action_type:b("MercuryActionType").CHANGE_PINNED_STATUS,thread_fbid:e,other_user_fbid:null,is_pinned:c.isPinned,thread_id:a};else return undefined}}function B(a,c){var d=c.threadKey.threadFbId;if(d==null)return undefined;else{a=h(a,{otherUserFbId:null,threadFbId:d});if(a!==undefined)return{action_type:b("MercuryActionType").UPDATE_JOINABLE_LINK,joinable_link:c.privateGroupLink,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a};else return undefined}}function C(a){__p&&__p();a=a.directives;if(a==null)return undefined;else{a=b("bs_belt_Array").get(a,0);if(a!==undefined){a=b("bs_js_primitive").valFromOption(a).data;if(a==null)return undefined;else{a=a.add_actions;if(a==null)return undefined;else{var c=a.actions;if(c==null)return undefined;else{c=b("bs_belt_Array").get(c,0);if(c!==undefined){c=b("bs_js_primitive").valFromOption(c).thread_key;if(c==null)return undefined;else{var d=c.thread_fbid;c=c.other_user_fbid;var e;if(d==null)if(c==null)return undefined;else c=c,e=1;else c=d,e=1;if(e===1)return{action_type:b("MercuryActionType").CREATE_OMNI_M_SUGGESTIONS,thread_fbid:b("MercuryIDs").getThreadIDFromThreadFBID(b("FBID.bs").ofStringExn(c)),other_user_fbid:null,thread_id:c,suggestions:a}}}else return undefined}}}}else return undefined}}function D(a){return{action_type:b("MercuryActionType").DELETE_MONTAGE_MESSAGES,threadFBID:a.threadFbid.toString(),messageFBID:a.messageFbid.toString()}}function E(a){return{action_type:b("MercuryActionType").NEW_MONTAGE_MESSAGE,thread_fbid:a.messageMetadata.threadFbid.toString(),actor_fbid:a.messageMetadata.actorFbid.toString(),message_fbid:a.messageMetadata.messageFbid.toString()}}function F(a,c){var d=c.threadKey.threadFbId;if(d==null)return undefined;else{a=h(a,{otherUserFbId:null,threadFbId:d});if(a!==undefined)return{action_type:b("MercuryActionType").PROMOTE_GROUP_ADMINS,thread_fbid:d.toString(),other_user_fbid:null,promoted_admins:b("bs_belt_Array").map(c.promotedAdmins,function(a){return{admin_fbid:a.adminFbId.toString(),admin_type:a.adminType}}),thread_id:a};else return undefined}}function G(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=c.threadKey.otherUserFbId;if(d==null)if(e==null)return undefined;else{var f=h(a,{otherUserFbId:e,threadFbId:null});if(f!==undefined)return{action_type:b("MercuryActionType").REMOVE_MESSAGE,thread_fbid:null,messageId:c.messageID,other_user_fbid:e.toString(),removed_timestamp:c.deletionTimestamp,thread_id:f};else return undefined}else{e=h(a,{otherUserFbId:null,threadFbId:d});if(e!==undefined)return{action_type:b("MercuryActionType").REMOVE_MESSAGE,thread_fbid:d.toString(),messageId:c.messageID,other_user_fbid:null,removed_timestamp:c.deletionTimestamp,thread_id:e};else return undefined}}function H(a,c){var d=c.threadKey.otherUserFbId;if(d==null)return undefined;else{a=h(a,{otherUserFbId:d,threadFbId:null});if(a!==undefined)return{action_type:b("MercuryActionType").UNSUBSCRIBE_STATUS_UPDATE,page_unsubscribe_status:c.unSubscribeStatus,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a};else return undefined}}function I(a,c){var d=c.threadKey.otherUserFbId;if(d==null)return undefined;else{a=h(a,{otherUserFbId:d,threadFbId:null});if(a!==undefined)return{action_type:b("MercuryActionType").IS_PIN_PROTECTED,thread_fbid:d.toString(),other_user_fbid:null,is_pin_protected:c.isPinProtected,thread_id:a};else return undefined}}function J(a,c){var d=c.threadKey.otherUserFbId;if(d==null)return undefined;else{a=h(a,{otherUserFbId:d,threadFbId:null});if(a!==undefined)return{action_type:b("MercuryActionType").UPDATE_CONNECTIVITY_STATUS,other_user_fbid:d.toString(),subtitle_type:c.subtitleType,thread_connectivity_status:c.threadConnectivityStatus,thread_fbid:d.toString(),thread_id:a};else return undefined}}var K=function(a){return String.fromCharCode.apply(null,a)};function L(a,c){__p&&__p();c=JSON.parse(K(c.payload));c=b("bs_js_json").classify(c);if(typeof c==="number"||c.tag!==2)return b("bs_block").__(1,["DeltaClientDelta","malformed payload"]);else{c=c[0].deltas;if(c!==undefined){c=b("bs_js_json").classify(c);if(typeof c==="number"||c.tag!==3)return b("bs_block").__(1,["DeltaClientDelta","delta is not an array"]);else{c=b("bs_belt_Array").get(c[0],0);if(c!==undefined){c=b("bs_js_json").classify(b("bs_js_primitive").valFromOption(c));if(typeof c==="number"||c.tag!==2)return b("bs_block").__(1,["DeltaClientDelta","client delta is not an object"]);else{c=c[0];var d=!1,e=0,f=c.deltaMessageReaction;if(f!==undefined){d=!0;f=n(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.deltaMessageReaction"):e=b("bs_block").__(1,["DeltaClientDelta.deltaMessageReaction","transform failed"])}f=c.liveLocationData;if(f!==undefined&&!d){d=!0;f=p(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.liveLocationData"):e=b("bs_block").__(1,["DeltaClientDelta.liveLocationData","transform failed"])}f=c.deltaUpdateGroupEventRSVPStatus;if(f!==undefined&&!d){d=!0;f=q(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.deltaUpdateGroupEventRSVPStatus"):e=b("bs_block").__(1,["DeltaClientDelta.deltaUpdateGroupEventRSVPStatus","transform failed"])}f=c.deltaPageThreadFollowUpData;if(f!==undefined&&!d){d=!0;f=r(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.deltaPageThreadFollowUpData"):e=b("bs_block").__(1,["DeltaClientDelta.deltaPageThreadFollowUpData","transform failed"])}f=c.deltaChangeViewerStatus;if(f!==undefined&&!d){d=!0;f=s(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.deltaChangeViewerStatus"):e=b("bs_block").__(1,["DeltaClientDelta.deltaChangeViewerStatus","transform failed"])}f=c.deltaMontageDirectExpire;if(f!==undefined&&!d){d=!0;f=t(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.deltaMontageDirectExpire"):e=b("bs_block").__(1,["DeltaClientDelta.deltaMontageDirectExpire","transform failed"])}f=c.deltaMessageReply;if(f!==undefined&&!d){d=!0;f=u(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.deltaMessageReply"):e=b("bs_block").__(1,["DeltaClientDelta.deltaMessageReply","transform failed"])}f=c.deltaUpdateGroupsSyncStatus;if(f!==undefined&&!d){d=!0;f=v(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.deltaUpdateGroupsSyncStatus"):e=b("bs_block").__(1,["DeltaClientDelta.deltaUpdateGroupsSyncStatus","transform failed"])}f=c.deltaUpdateGroupsSyncMetadata;if(f!==undefined&&!d){d=!0;f=w(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.deltaUpdateGroupsSyncMetadata"):e=b("bs_block").__(1,["DeltaClientDelta.deltaUpdateGroupsSyncMetadata","transform failed"])}f=c.deltaGroupThreadDescription;if(f!==undefined&&!d){d=!0;f=x(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.deltaGroupThreadDescription"):e=b("bs_block").__(1,["DeltaClientDelta.deltaGroupThreadDescription","transform failed"])}f=c.deltaUpdateThreadTheme;if(f!==undefined&&!d){d=!0;f=z(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.deltaUpdateThreadTheme"):e=b("bs_block").__(1,["DeltaClientDelta.deltaUpdateThreadTheme","transform failed"])}f=c.deltaUpdatePinnedThread;if(f!==undefined&&!d){d=!0;f=A(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.deltaUpdatePinnedThread"):e=b("bs_block").__(1,["DeltaClientDelta.deltaUpdatePinnedThread","transform failed"])}f=c.deltaUpdatePrivateGroupJoinableLink;if(f!==undefined&&!d){d=!0;f=B(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.deltaUpdatePrivateGroupJoinableLink"):e=b("bs_block").__(1,["DeltaClientDelta.deltaUpdatePrivateGroupJoinableLink","transform failed"])}f=c.deltaOmniMDirectivesV2;if(f!==undefined&&!d){d=!0;f=C(f);if(f!==undefined){f=b("bs_js_primitive").valFromOption(f);e=b("bs_block").__(0,["DeltaClientDelta.deltaOmniMDirectivesV2"]);b("MSuggestionActions").saveAllSuggestions(f.thread_id,f.suggestions)}else e=b("bs_block").__(1,["DeltaClientDelta.deltaOmniMDirectivesV2","transform failed"])}f=c.deltaMontageMessageDelete;if(f!==undefined&&!d){d=!0;f=D(f);if(f!==undefined){f=b("bs_js_primitive").valFromOption(f);if(b("gkx")("678586"))e=b("bs_block").__(0,["DeltaClientDelta.deltaMontageMessageDelete"]),b("MontageActions").deleteMontage(a,f);else{f=b("FBID.bs").ofString(f.threadFBID);f!==undefined?(e=b("bs_block").__(0,["DeltaClientDelta.deltaMontageMessageDelete"]),b("MontageActions").requestUpdate(b("bs_js_primitive").valFromOption(f))):e=b("bs_block").__(1,["DeltaClientDelta.deltaMontageMessageDelete","no threadFBID"])}}else e=b("bs_block").__(1,["DeltaClientDelta.deltaMontageMessageDelete","transform failed"])}f=c.deltaNewMontageMessage;if(f!==undefined&&!d){d=!0;f=E(f);if(f!==undefined){f=b("bs_js_primitive").valFromOption(f);if(b("gkx")("678586"))e=b("bs_block").__(0,["DeltaClientDelta.deltaNewMontageMessage"]),b("MontageActions").handleNewMontageDelta(a,f);else{f=b("FBID.bs").ofString(f.thread_fbid);f!==undefined?(e=b("bs_block").__(0,["DeltaClientDelta.deltaNewMontageMessage"]),b("MontageActions").requestUpdate(b("bs_js_primitive").valFromOption(f))):e=b("bs_block").__(1,["DeltaClientDelta.deltaNewMontageMessage","no thread_fbid"])}}else e=b("bs_block").__(1,["DeltaClientDelta.deltaNewMontageMessage","transform failed"])}f=c.deltaPromoteGroupThreadAdmin;if(f!==undefined&&!d){d=!0;f=F(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.deltaPromoteGroupThreadAdmin"):e=b("bs_block").__(1,["DeltaClientDelta.deltaPromoteGroupThreadAdmin","transform failed"])}f=c.deltaRecallMessageData;if(f!==undefined&&!d){d=!0;f=G(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.deltaRecallMessageData"):e=b("bs_block").__(1,["DeltaClientDelta.deltaRecallMessageData","transform failed"])}f=c.deltaPageUnSubscribeStatus;if(f!==undefined&&!d){d=!0;f=H(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.deltaPageUnSubscribeStatus"):e=b("bs_block").__(1,["DeltaClientDelta.deltaPageUnSubscribeStatus","transform failed"])}f=c.deltaPaymentPinProtectionStatusData;if(f!==undefined){if(!d){d=!0;f=I(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.deltaPaymentPinProtectionStatusData"):e=b("bs_block").__(1,["DeltaClientDelta.deltaPaymentPinProtectionStatusData","transform failed"])}}else d||(e=b("bs_block").__(1,["DeltaClientDelta","unknown delta type: "+Object.keys(c).join()]));f=c.deltaThreadConnectivityStatusUpdate;if(f!==undefined){if(!d){d=!0;f=J(a,f);f!==undefined?m(a,b("bs_js_primitive").valFromOption(f),"DeltaClientDelta.deltaThreadConnectivityStatusUpdateData"):e=b("bs_block").__(1,["DeltaClientDelta.deltaThreadConnectivityStatusUpdateData","transform failed"])}}else d||(e=b("bs_block").__(1,["DeltaClientDelta","unknown delta type: "+Object.keys(c).join()]));return e}}else return b("bs_block").__(1,["DeltaClientDelta","client delta is missing"])}}else return b("bs_block").__(1,["DeltaClientDelta","client delta has no deltas"])}}function M(a,c){__p&&__p();var d=[],e=[],f=c.folders,g=0;!(f==null)&&f.length!==0?b("bs_belt_Array").forEachU(f,function(a){d.push({action_type:b("MercuryGlobalActionType").MARK_ALL_READ,action_id:null,folder:b("bs_js_primitive").undefined_to_opt(b("MessagingTag").IRIS_MAPPING[a]),timestamp:parseInt(c.watermarkTimestamp,10)});return 0}):g=1;g===1&&b("bs_belt_Array").forEachU(c.threadKeys,function(f){var d=h(a,f);if(d!==undefined){var g=parseInt(c.watermarkTimestamp,10);b("MercuryServerRequests").getForFBID(a).updateLastActionTimestamp(g);e.push({thread_id:d,action_type:b("MercuryActionType").CHANGE_READ_STATUS,other_user_fbid:f.otherUserFbId,thread_fbid:f.threadFbId,mark_as_read:!0,timestamp:g,folder:b("MessagingTag").INBOX});return 0}else return 0});return[d,e]}function N(a){if(a==null)return null;else return a.toString()}function O(a,c){__p&&__p();var d;switch(c.tag|0){case 0:var e=i(a,c[0]);m(a,e,"deltaNewMessage");d=0;break;case 1:e=c[0];m(a,Object.assign(i(a,e.newMessage),{action_type:b("MercuryActionType").REPLACE_MESSAGE,replaced_message_id:e.replacedMessageId}),"deltaReplaceMessage");d=0;break;case 2:e=c[0];var f=e.threadKey.otherUserFbId,g;if(f==null){var j=e.threadKey.threadFbId;if(j==null)g=undefined;else{var n=b("MercuryThreadIDMap").getForFBID(a);n=n.getClientIDFromServerIDNow(j.toString());g=n==null?undefined:b("bs_js_primitive").some(n)}}else{j=b("FBID.bs").ofString(f.toString());g=j!==undefined?b("bs_js_primitive").some(b("MercuryIDs").getThreadIDFromUserID(b("bs_js_primitive").valFromOption(j))):undefined}if(g!==undefined){n={};n[b("bs_js_primitive").valFromOption(g)]=parseInt(e.deliveredWatermarkTimestampMs,10);b("MercuryDispatcher").getForFBID(a).handleUpdate({delivery_receipts:n,pinned_thread_ids:[],newlyAddedClientIDs:{},actions:[],preprocessed:!0});d=b("bs_block").__(0,["DeltaDeliveryReceipt"])}else d=b("bs_block").__(1,["DeltaDeliveryReceipt","no thread id"]);break;case 3:f=M(a,c[0]);j=f[1];g=f[0];g.length&&b("MercuryDispatcher").getForFBID(a).handleUpdate({actions:[],global_actions:g,pinned_thread_ids:[],newlyAddedClientIDs:{},preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});j.length&&b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:j,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=g.length===0&&j.length===0?b("bs_block").__(1,["DeltaMarkRead","no local or global action"]):b("bs_block").__(0,["DeltaMarkRead"]);break;case 4:var o=c[0];e=b("bs_belt_Array").keepMapU(o.threadKeys,function(d){var c=h(a,d);if(c!==undefined){var e=parseInt(o.watermarkTimestamp,10);b("MercuryServerRequests").getForFBID(a).updateLastActionTimestamp(e);return{thread_id:c,action_type:b("MercuryActionType").CHANGE_READ_STATUS,other_user_fbid:d.otherUserFbId,thread_fbid:d.threadFbId,mark_as_read:!1,timestamp:e,folder:b("MessagingTag").INBOX}}});b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:e,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaMarkUnread"]);break;case 5:n=c[0];m(a,Object.assign(i(a,n),{action_type:b("MercuryActionType").LOG_MESSAGE,log_message_body:n.messageMetadata.adminText,log_message_data:{removed_participants:[b("MercuryIDs").getParticipantIDFromUserID(n.leftParticipantFbId)]},log_message_type:b("MercuryLogMessageType").UNSUBSCRIBE}),"DeltaParticipantLeftGroupThread");d=0;break;case 6:f=c[0];m(a,Object.assign(i(a,f),{action_type:b("MercuryActionType").LOG_MESSAGE,log_message_body:f.messageMetadata.adminText,log_message_data:{added_participants:b("bs_belt_Array").map(f.addedParticipants,function(a){return b("MercuryIDs").getParticipantIDFromUserID(a.userFbId)})},log_message_type:b("MercuryLogMessageType").SUBSCRIBE}),"DeltaParticipantsAddedToGroupThread");d=0;break;case 7:g=c[0];j=i(a,g);e=b("FBID.bs").ofString(g.messageMetadata.actorFbId.toString());if(e!==undefined){n=b("bs_js_primitive").valFromOption(e);if(b("bs_caml_obj").caml_notequal(n,a))f=b("bs_js_primitive").some(a);else{e=g.messageMetadata.threadKey.otherUserFbId;if(e==null)f=undefined;else{e=b("FBID.bs").ofString(e.toString());f=e!==undefined?e:undefined}}if(f!==undefined){e=g.eventType;var p;if(e==null)p=b("MercuryLogMessageType").VIDEO_CALL;else{e=e==="VOICE_EVENT";p=e?b("MercuryLogMessageType").PHONE_CALL:b("MercuryLogMessageType").VIDEO_CALL}e=g.duration;m(a,Object.assign(j,{action_type:b("MercuryActionType").LOG_MESSAGE,log_message_body:g.messageMetadata.adminText,log_message_data:{answered:e==null?!1:e>0,callee:b("MercuryIDs").getParticipantIDFromUserID(b("bs_js_primitive").valFromOption(f)),caller:b("MercuryIDs").getParticipantIDFromUserID(n)},log_message_type:p,message_unsendability_status:b("MessageUnsendabilityStatus.bs").fromNullableString(g.messageMetadata.unsendType)}),"DeltaRTCEventLog");d=0}else d=b("bs_block").__(1,["DeltaParticipantsAddedToGroupThread","calleeFBID is invalid"])}else d=b("bs_block").__(1,["DeltaRTCEventLog","actorFbId is not an fbid"]);break;case 8:j=c[0];m(a,Object.assign(i(a,j),{action_type:b("MercuryActionType").LOG_MESSAGE,log_message_body:j.messageMetadata.adminText,log_message_data:{name:j.name},log_message_type:b("MercuryLogMessageType").THREAD_NAME}),"DeltaThreadName");d=0;break;case 9:e=c[0];f={watermark:parseInt(e.watermarkTimestampMs,10),action:parseInt(e.actionTimestampMs,10)};n=e.threadKey.otherUserFbId;p=n==null?b("bs_js_primitive").nullable_to_opt(e.actorFbId):n.toString();g=e.threadKey.otherUserFbId;if(g==null){j=e.threadKey.threadFbId;n=j==null?undefined:j.toString()}else n=g.toString();if(p!==undefined)if(n!==undefined){e=n;j=b("MercuryThreadIDMap").getForFBID(a);g=j.getClientIDFromServerIDNow(e);if(g==null)d=b("bs_block").__(1,["DeltaReadReceipt","No clientID for serverID: "+e]);else{n={};j={};e=b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(p));j[e]=f;n[g]=j;b("MercuryDispatcher").getForFBID(a).handleUpdate({roger:n,pinned_thread_ids:[],newlyAddedClientIDs:{},actions:[],preprocessed:!0});d=b("bs_block").__(0,["DeltaReadReceipt"])}}else d=b("bs_block").__(1,["DeltaReadReceipt","serverID is invalid"]);else d=b("bs_block").__(1,["DeltaReadReceipt","userID is invalid"]);break;case 10:p=c[0];m(a,Object.assign(i(a,p),{action_type:b("MercuryActionType").LOG_MESSAGE,log_message_body:p.messageMetadata.adminText,log_message_data:{message_type:p.type,untypedData:p.untypedData},log_message_type:b("MercuryLogMessageType").GENERIC_ADMIN_TEXT,message_unsendability_status:b("MessageUnsendabilityStatus.bs").fromNullableString(p.messageMetadata.unsendType)}),"DeltaAdminTextMessage");d=0;break;case 11:e=c[0];f=h(a,{otherUserFbId:e.threadKey.otherUserFbId,threadFbId:e.threadKey.threadFbId});g=f!==undefined?{action_type:b("MercuryActionType").DELETE_MESSAGES,message_ids:e.messageIds,other_user_fbid:N(e.threadKey.otherUserFbId),thread_fbid:N(e.threadKey.threadFbId),thread_id:f}:undefined;j=e.threadKey.threadFbId;n=e.folder;if(g!==undefined){p=b("bs_js_primitive").valFromOption(g);j==null?(m(a,p,"DeltaMessageDelete"),d=0):n==null?(m(a,p,"DeltaMessageDelete"),d=0):(n==="FOLDER_MONTAGE"?b("MontageActions").requestUpdate(j.toString()):m(a,p,"DeltaMessageDelete"),d=0)}else d=b("bs_block").__(1,["DeltaMessageDelete","transform failed"]);break;case 12:f=c[0];e=h(a,{otherUserFbId:f.threadKey.otherUserFbId,threadFbId:f.threadKey.threadFbId});if(e!==undefined){g=f.action;m(a,{action_type:b("MercuryActionType").CHANGE_ARCHIVED_STATUS,thread_fbid:N(f.threadKey.threadFbId),other_user_fbid:N(f.threadKey.otherUserFbId),archived:g==null?!1:g===b("MessagingThreadAction").ACTION_ARCHIVED,thread_id:e},"DeltaThreadAction");d=0}else d=b("bs_block").__(1,["DeltaThreadAction","transform failed"]);break;case 13:n=b("bs_belt_Array").keepMapU(c[0].threadKeys,function(d){var c=h(a,d);if(c!==undefined)return{thread_id:c,action_type:b("MercuryActionType").DELETE_THREAD,other_user_fbid:d.otherUserFbId,thread_fbid:d.threadFbId}});b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:n,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaThreadDelete"]);break;case 14:j=c[0];p=h(a,{otherUserFbId:null,threadFbId:j.messageMetadata.threadKey.threadFbId});p!==undefined?(m(a,{action_type:b("MercuryActionType").ADD_GROUP_ADMINS,action_id:null,thread_fbid:N(j.messageMetadata.threadKey.threadFbId),other_user_fbid:null,added_admin_ids:b("bs_belt_Array").map(j.addedAdmins,function(a){return a.userFbId}),thread_id:p},"DeltaAdminAddedToGroupThread"),d=0):d=b("bs_block").__(1,["DeltaAdminAddedToGroupThread","transform failed"]);break;case 15:f=c[0];g=h(a,{otherUserFbId:null,threadFbId:f.messageMetadata.threadKey.threadFbId});g!==undefined?(m(a,{action_type:b("MercuryActionType").REMOVE_GROUP_ADMINS,action_id:null,thread_fbid:N(f.messageMetadata.threadKey.threadFbId),other_user_fbid:null,removed_admin_ids:f.removedAdminFbIds,thread_id:g},"DeltaAdminRemovedFromGroupThread"),d=0):d=b("bs_block").__(1,["DeltaAdminRemovedFromGroupThread","transform failed"]);break;case 16:e=c[0];n=h(a,e.threadKey);if(n!==undefined){j=[{thread_id:n,action_type:b("MercuryActionType").CHANGE_MUTE_SETTINGS,thread_fbid:e.threadKey.threadFbId,other_user_fbid:e.threadKey.otherUserFbId,mute_until:parseInt(e.expireTime,10)}];b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:j,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaThreadMuteSettings"])}else d=b("bs_block").__(1,["DeltaThreadMuteSettings","invalid thread ID"]);break;case 17:p=c[0];f=p.jsonBlob;if(f==null)d=b("bs_block").__(1,["DeltaPagesManagerEvent","no jsonBlob"]);else{try{g=JSON.parse(f)}catch(a){g={}}n=b("bs_js_json").classify(g);if(typeof n==="number"||n.tag!==2)d=b("bs_block").__(1,["DeltaPagesManagerEvent","jsonBlob is not an object"]);else{e=n[0];j=e.type;if(j!==undefined){f=b("bs_js_json").classify(j);if(typeof f==="number"||f.tag!==1)d=b("bs_block").__(1,["DeltaPagesManagerEvent","type is not a number"]);else if(f[0]===b("PagesMessagingEventType").FLAG){g=e.flagData;if(g!==undefined){n=b("bs_js_json").classify(g);if(typeof n==="number"||n.tag!==2)j=!1;else{f=n[0].state;if(f!==undefined){e=b("bs_js_json").classify(f);j=typeof e==="number"?e===1:!1}else j=!1}}else j=!1;g=h(a,p.threadKey);if(g!==undefined){n=[{thread_id:g,action_type:b("MercuryActionType").CHANGE_FLAG,mark_as_flag:j,other_user_fbid:p.threadKey.otherUserFbId,thread_fbid:p.threadKey.threadFbId}];b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:n,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaPagesManagerEvent"])}else d=b("bs_block").__(1,["DeltaPagesManagerEvent","threadID is invalid"])}else d=b("bs_block").__(1,["DeltaPagesManagerEvent","type is not pagesFlag"])}else d=b("bs_block").__(1,["DeltaPagesManagerEvent","no type on jsonBlob"])}}break;case 18:f=c[0];e=h(a,{otherUserFbId:null,threadFbId:f.messageMetadata.threadKey.threadFbId});e!==undefined?(m(a,{action_type:b("MercuryActionType").JOINABLE_MODE,action_id:null,thread_fbid:N(f.messageMetadata.threadKey.threadFbId),other_user_fbid:null,joinable_mode:{mode:b("bs_js_null_undefined").fromOption(b("bs_js_primitive").undefined_to_opt(b("MessengerJoinableModeType")[f.mode])),link:f.link,thread_id:e}},"DeltaJoinableMode"),d=0):d=b("bs_block").__(1,["DeltaJoinableMode","transform failed"]);break;case 19:g=c[0];j=h(a,{otherUserFbId:null,threadFbId:g.messageMetadata.threadKey.threadFbId});j!==undefined?(m(a,{action_type:b("MercuryActionType").APPROVAL_MODE,action_id:null,thread_fbid:N(g.messageMetadata.threadKey.threadFbId),other_user_fbid:null,approval_mode:b("bs_js_null_undefined").fromOption(b("bs_js_primitive").undefined_to_opt(b("MessengerApprovalModeTypes")[g.mode])),thread_id:j},"DeltaApprovalMode"),d=0):d=b("bs_block").__(1,["DeltaApprovalMode","transform failed"]);break;case 20:p=c[0];n=h(a,{otherUserFbId:p.messageMetadata.threadKey.otherUserFbId,threadFbId:p.messageMetadata.threadKey.threadFbId});if(n!==undefined){f=n;e=p.inviterFbId;if(e==null){g=p.recipientFbId;if(!(g==null)){j=b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(g));n=p.action===b("MessengerApprovalQueueTypes").REMOVED;g=p.action===b("MessengerApprovalQueueTypes").REQUESTED;m(a,{action_type:b("MercuryActionType").APPROVAL_QUEUE,action_id:null,thread_fbid:N(p.messageMetadata.threadKey.threadFbId),other_user_fbid:N(p.messageMetadata.threadKey.otherUserFbId),removed_id:n?j:null,added_id:g?j:null,thread_id:f},"DeltaApprovalQueue")}}else{n=p.action===b("MessengerApprovalQueueTypes").REMOVED;g=p.action===b("MessengerApprovalQueueTypes").REQUESTED;if(g){j=p.requestSource;var q;if(j==null)q=b("MessengerGroupRequestSource").ADD;else switch(j){case"ADD":q=b("MessengerGroupRequestSource").ADD;break;case"JOIN_THROUGH_LINK":q=b("MessengerGroupRequestSource").JOIN_THROUGH_LINK;break;default:q=b("MessengerGroupRequestSource").ADD}g={requester:{id:p.recipientFbId},inviter:{id:e},request_source:q,request_timestamp:p.requestTimestamp}}else g=null;m(a,{action_type:b("MercuryActionType").APPROVAL_QUEUE,action_id:null,thread_fbid:N(p.messageMetadata.threadKey.threadFbId),other_user_fbid:N(p.messageMetadata.threadKey.otherUserFbId),removed_group_id:n?p.recipientFbId:null,added_group_id:g,thread_id:f},"DeltaApprovalQueue")}d=0}else d=b("bs_block").__(1,["DeltaApprovalQueue","transform failed"]);break;case 21:m(a,i(a,c[0].deltaNewMessage),"DeltaGenieMessage");d=0;break;case 22:j=c[0].newMessage.messageMetadata.actorFbId;j==null?d=b("bs_block").__(1,["DeltaMontageMessage","newMessage.messageMetadata.actorFbId is empty"]):(b("MontageActions").requestUpdate(j),d=b("bs_block").__(0,["DeltaMontageMessage"]));break;case 23:e=c[0];n=e.messageMetadata.threadKey;if(n==null)p=undefined;else{g=n.threadFbId;p=g==null?undefined:g}f=e.initiator;if(f==null)j=undefined;else{n=f.userFbId;j=n==null?undefined:n.toString()}g=h(a,{otherUserFbId:null,threadFbId:p});g!==undefined?(m(a,{action_type:b("MercuryActionType").UPDATE_RTC_CALL_DATA,thread_fbid:N(p),other_user_fbid:null,call_state:e.callState,server_info_data:e.serverInfoData,initiator_fbid:j,thread_id:g},"DeltaRTCCallData"),d=0):d=b("bs_block").__(1,["DeltaRTCCallData","transform failed"]);break;case 24:var r=c[0];b("MercuryDispatcher").getForFBID(a).handleUpdate({actions:[],global_actions:b("bs_belt_Array").mapU(r.folders,function(a){return{action_type:b("MercuryGlobalActionType").MARK_ALL_SEEN,folder:b("bs_js_primitive").undefined_to_opt(b("MessagingTag").IRIS_MAPPING[a]),timestamp:parseInt(r.timestamp,10)}}),pinned_thread_ids:[],newlyAddedClientIDs:{},preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaMarkFolderSeen"]);break;case 25:f=c[0];n=h(a,f.threadKey);if(n!==undefined){p=[{thread_id:n,action_type:b("MercuryActionType").CHANGE_FOLDER,other_user_fbid:f.threadKey.otherUserFbId,new_folder:b("bs_js_primitive").undefined_to_opt(b("MessagingTag").IRIS_MAPPING[f.folder])}];b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:p,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaThreadFolder"])}else d=b("bs_block").__(1,["DeltaThreadFolder","threadID is invalid"]);break;case 26:d=L(a,c[0]);break}if(typeof d==="number")return 0;else if(d.tag)return l(d[0],d[1]);else return k(d[0])}function a(a,c){__p&&__p();if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").NewMessage))return O(a,b("bs_block").__(0,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ReplaceMessage))return O(a,b("bs_block").__(1,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").DeliveryReceipt))return O(a,b("bs_block").__(2,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").MarkRead))return O(a,b("bs_block").__(3,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").MarkUnread))return O(a,b("bs_block").__(4,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ParticipantLeftGroupThread))return O(a,b("bs_block").__(5,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ParticipantsAddedToGroupThread))return O(a,b("bs_block").__(6,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").RTCEventLog))return O(a,b("bs_block").__(7,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadName))return O(a,b("bs_block").__(8,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ReadReceipt))return O(a,b("bs_block").__(9,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").AdminTextMessage))return O(a,b("bs_block").__(10,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").MessageDelete))return O(a,b("bs_block").__(11,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadAction))return O(a,b("bs_block").__(12,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadDelete))return O(a,b("bs_block").__(13,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").AdminAddedToGroupThread))return O(a,b("bs_block").__(14,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").AdminRemovedFromGroupThread))return O(a,b("bs_block").__(15,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadMuteSettings))return O(a,b("bs_block").__(16,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").PagesManagerEvent))return O(a,b("bs_block").__(17,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").JoinableMode))return O(a,b("bs_block").__(18,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ApprovalMode))return O(a,b("bs_block").__(19,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ApprovalQueue))return O(a,b("bs_block").__(20,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ClientPayload))return O(a,b("bs_block").__(26,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").GenieMessage))return O(a,b("bs_block").__(21,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").MontageMessage))return O(a,b("bs_block").__(22,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").RtcCallData))return O(a,b("bs_block").__(23,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").MarkFolderSeen))return O(a,b("bs_block").__(24,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadFolder))return O(a,b("bs_block").__(25,[c]));else return 0}f.transform=a}),null);